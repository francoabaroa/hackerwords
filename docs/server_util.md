<div id="main">

# Source: server/util.js

<section>

<article>

    /**
     * @file This has all the server-side utility functions needed to check authentication, get userID, etc
     */

    /** @module Authentication Utility Server-Side Functions */

    const jwt = require('jwt-simple');
    const User = require('./users/userModel.js');

    /**
      * This function is used to find the userId from database given a username.
      * @method getUserIDFromUsername
      * @param {string} username username
      * @param {object} callback callback function
      */
    exports.getUserIDFromUsername = (username, callback) => {
      User.findOne({ username }, (err, result) => {
        callback(result._id);
      });
    };

    /**
      * This function is used to get the username from the request object.
      * @method getUsernameFromReq
      * @param {object} req req object
      * @param {object} next callback function to execute next
      */
    exports.getUsernameFromReq = (req, next) => {

      /** Recover username */
      console.log('HEADERS = ', req.headers);
      const token = req.headers['x-access-token'];
      if (!token) {
        next(new Error('No token'));
        return null;
      }
      const username = jwt.decode(token, 'secret').username;
      return username;
    };

    /**
      * This function is used to get the user from the database.
      * @method getUserFromReq
      * @param {object} req req object
      * @param {object} next callback function to execute next
      * @returns {object} returns user object
      */
    exports.getUserFromReq = (req, next) => {
      const username = exports.getUsernameFromReq(req, next);
      return User.findOne({ username });
    };

    /**
      * This function is a middleware function to check authentication.
      * @method checkAuth
      * @param {object} req request object
      * @param {object} res response object
      * @param {object} next callback function to execute next
      * @returns {boolean}
      */
    exports.checkAuth = (req, res, next) => {
      const token = req.headers['x-access-token'];
      if (!token) {
        next(new Error('No token in util.checkAuth'));
        return null;
      }
      try {
        const username = jwt.decode(token, 'secret').username;
        next();
        return true;
      } catch (e) {
        next(new Error('Invalid Token!'));
        return null;
      }
    };

    /**
      * This function is used to check if a user is real user in the database.
      * @method checkIsRealUser
      * @param {string} username username
      * @param {object} callback callback function to execute
      * @returns {boolean}
      */
    exports.checkIsRealUser = (username, callback) => {
      User.find({}, (err, result) => {
        const allUsers = result.map(userEntry => (userEntry.username));

        if (allUsers.indexOf(username) < 0) {
          callback(err, false);
        } else {
          callback(err, true);
        }
      });
    };

</article>

</section>

</div>

<nav>

## [Home](index.html)

### Modules

*   [Authentication Utility Client-Side Functions](module-Authentication%2520Utility%2520Client-Side%2520Functions.html)
*   [Authentication Utility Server-Side Functions](module-Authentication%2520Utility%2520Server-Side%2520Functions.html)
*   [Board](module-Board.html)
*   [Board Tools Functions](module-Board%2520Tools%2520Functions.html)
*   [Game Model](module-Game%2520Model.html)
*   [Middleware](module-Middleware.html)
*   [Played Words](module-Played%2520Words.html)
*   [Router](module-Router.html)
*   [Score](module-Score.html)
*   [Server](module-Server.html)
*   [User Controller](module-User%2520Controller.html)
*   [User Model](module-User%2520Model.html)

### Classes

*   [App](App.html)
*   [Challenges](Challenges.html)
*   [GameHistory](GameHistory.html)
*   [Lobby](Lobby.html)
*   [Players](Players.html)
*   [Signin](Signin.html)
*   [Signup](Signup.html)

</nav>

<footer>Documentation generated by [JSDoc 3.4.2](https://github.com/jsdoc3/jsdoc) on Sun Oct 30 2016 18:04:20 GMT-0700 (PDT)</footer>

<script>prettyPrint();</script>